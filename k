#!/bin/sh

# flags: --tree to get containment tree, --error to get syntax/type errors, --solve to get syntax/type errors and solve

if [ -n "$M2_REPO" ]; then
    m2=$M2_REPO
else
    m2=${HOME}/.m2/repository
fi

solve=true

cd ${HOME}/git/kservices


for arg in "$@"; do
	case "$arg" in
    	"--error") solve=false;;
    	"--tree") solve=false;;
    esac
done
   


javac -classpath ${HOME}/git/kservices/target/classes:${HOME}/git/Klang/target/classes:${HOME}/git/Klang/src/antlr-4.4-complete.jar:${m2}/org/antlr/antlr4/4.5/antlr4-4.5.jar:${m2}/org/antlr/antlr4-runtime/4.5/antlr4-runtime-4.5.jar:${m2}/org/abego/treelayout/org.abego.treelayout.core/1.0.1/org.abego.treelayout.core-1.0.1.jar:${m2}/org/antlr/antlr-runtime/3.5.2/antlr-runtime-3.5.2.jar:${m2}/org/antlr/ST4/4.0.8/ST4-4.0.8.jar:${m2}/log4j/log4j/1.2.16/log4j-1.2.16.jar:${HOME}/git/Klang/lib/com.microsoft.z3.jar:${m2}/javax/servlet/servlet-api/2.4/servlet-api-2.4.jar:${m2}/org/eclipse/jetty/jetty-server/9.2.12.v20150709/jetty-server-9.2.12.v20150709.jar:${m2}/javax/servlet/javax.servlet-api/3.1.0/javax.servlet-api-3.1.0.jar:${m2}/org/eclipse/jetty/jetty-http/9.2.12.v20150709/jetty-http-9.2.12.v20150709.jar:${m2}/org/eclipse/jetty/jetty-util/9.2.12.v20150709/jetty-util-9.2.12.v20150709.jar:${m2}/org/eclipse/jetty/jetty-io/9.2.12.v20150709/jetty-io-9.2.12.v20150709.jar:${m2}/org/scala-lang/scala-library/2.11.8/scala-library-2.11.8.jar:${m2}/org/scala-lang/scala-actors/2.11.8/scala-actors-2.11.8.jar:${m2}/org/scala-lang/modules/scala-xml_2.11/1.0.3/scala-xml_2.11-1.0.3.jar:${m2}/org/scala-lang/modules/scala-parser-combinators_2.11/1.0.3/scala-parser-combinators_2.11-1.0.3.jar:${m2}/org/scala-lang/modules/scala-swing_2.11/1.0.1/scala-swing_2.11-1.0.1.jar:${HOME}/git/bae/target/classes:/private/var/folders/bx/c5nzpxn14fqdplw7hbznyx0xgnhpqy/T/AppTranslocation/E7A90B53-9C5E-48BD-909F-383F1A03D8AC/d/Eclipse.app/Contents/Eclipse/plugins/org.junit_4.12.0.v201504281640/junit.jar:/private/var/folders/bx/c5nzpxn14fqdplw7hbznyx0xgnhpqy/T/AppTranslocation/E7A90B53-9C5E-48BD-909F-383F1A03D8AC/d/Eclipse.app/Contents/Eclipse/plugins/org.hamcrest.core_1.3.0.v201303031735.jar:${m2}/gov/nasa/jpl/mbee/util/mbee_util/2.3.4-SNAPSHOT/mbee_util-2.3.4-SNAPSHOT.jar:${m2}/org/json/json/20140107/json-20140107.jar${m2}/org/json/json/20140107/json-20140107.jar:${m2}/org/apache/commons/commons-lang3/3.0/commons-lang3-3.0.jar:${HOME}/git/sysml/target/classes:${HOME}/git/util/bin:${m2}/junit/junit/4.8.1/junit-4.8.1.jar:${m2}/org/apache/commons/commons-collections4/4.0/commons-collections4-4.0.jar:${m2}/org/eclipse/emf/org.eclipse.emf.ecore/2.9.1-v20130827-0309/org.eclipse.emf.ecore-2.9.1-v20130827-0309.jar:${m2}/concurrent/concurrent/1.3.3/concurrent-1.3.3.jar:${m2}/org/scijava/jython-shaded/2.5.3/jython-shaded-2.5.3.jar:${m2}/log4j/log4j/1.2.17/log4j-1.2.17.jar:${m2}/gov/nasa/jpl/mbee/sysml/sysml/2.3.4-SNAPSHOT/sysml-2.3.4-SNAPSHOT.jar:${m2}/gov/nasa/jpl/mbee/bae/bae/2.3.4-SNAPSHOT/bae-2.3.4-SNAPSHOT.jar ${HOME}/git/kservices/src/gov/nasa/jpl/kservices/*.java &&

java -Dfile.encoding=UTF-8 -classpath ${HOME}/git/kservices/target/classes:${HOME}/git/Klang/target/classes:${HOME}/git/Klang/src/antlr-4.4-complete.jar:${m2}/log4j/log4j/1.2.17/log4j-1.2.17.jar:${m2}/gov/nasa/jpl/mbee/sysml/sysml/2.3.4-SNAPSHOT/sysml-2.3.4-SNAPSHOT.jar:${m2}/gov/nasa/jpl/mbee/bae/bae/2.3.4-SNAPSHOT/bae-2.3.4-SNAPSHOT.jar:${m2}/org/antlr/antlr4/4.5/antlr4-4.5.jar:${m2}/org/antlr/antlr4-runtime/4.5/antlr4-runtime-4.5.jar:${m2}/org/abego/treelayout/org.abego.treelayout.core/1.0.1/org.abego.treelayout.core-1.0.1.jar:${m2}/org/antlr/antlr-runtime/3.5.2/antlr-runtime-3.5.2.jar:${m2}/org/antlr/ST4/4.0.8/ST4-4.0.8.jar:${m2}/log4j/log4j/1.2.16/log4j-1.2.16.jar:${HOME}/git/Klang/lib/com.microsoft.z3.jar:${m2}/javax/servlet/servlet-api/2.4/servlet-api-2.4.jar:${m2}/org/eclipse/jetty/jetty-server/9.2.12.v20150709/jetty-server-9.2.12.v20150709.jar:${m2}/javax/servlet/javax.servlet-api/3.1.0/javax.servlet-api-3.1.0.jar:${m2}/org/eclipse/jetty/jetty-http/9.2.12.v20150709/jetty-http-9.2.12.v20150709.jar:${m2}/org/eclipse/jetty/jetty-util/9.2.12.v20150709/jetty-util-9.2.12.v20150709.jar:${m2}/org/eclipse/jetty/jetty-io/9.2.12.v20150709/jetty-io-9.2.12.v20150709.jar:${m2}/org/scala-lang/scala-library/2.11.8/scala-library-2.11.8.jar:${m2}/org/scala-lang/scala-actors/2.11.8/scala-actors-2.11.8.jar:${m2}/org/scala-lang/modules/scala-xml_2.11/1.0.3/scala-xml_2.11-1.0.3.jar:${m2}/org/scala-lang/modules/scala-parser-combinators_2.11/1.0.3/scala-parser-combinators_2.11-1.0.3.jar:${m2}/org/scala-lang/modules/scala-swing_2.11/1.0.1/scala-swing_2.11-1.0.1.jar:${HOME}/git/bae/target/classes:/private/var/folders/bx/c5nzpxn14fqdplw7hbznyx0xgnhpqy/T/AppTranslocation/E7A90B53-9C5E-48BD-909F-383F1A03D8AC/d/Eclipse.app/Contents/Eclipse/plugins/org.junit_4.12.0.v201504281640/junit.jar:/private/var/folders/bx/c5nzpxn14fqdplw7hbznyx0xgnhpqy/T/AppTranslocation/E7A90B53-9C5E-48BD-909F-383F1A03D8AC/d/Eclipse.app/Contents/Eclipse/plugins/org.hamcrest.core_1.3.0.v201303031735.jar:${m2}/gov/nasa/jpl/mbee/util/mbee_util/2.3.4-SNAPSHOT/mbee_util-2.3.4-SNAPSHOT.jar:${m2}/org/json/json/20140107/json-20140107.jar:${m2}/org/apache/commons/commons-lang3/3.0/commons-lang3-3.0.jar:${HOME}/git/sysml/target/classes:${HOME}/git/util/bin:${m2}/junit/junit/4.8.1/junit-4.8.1.jar:${m2}/org/apache/commons/commons-collections4/4.0/commons-collections4-4.0.jar:${m2}/org/eclipse/emf/org.eclipse.emf.ecore/2.9.1-v20130827-0309/org.eclipse.emf.ecore-2.9.1-v20130827-0309.jar:${m2}/concurrent/concurrent/1.3.3/concurrent-1.3.3.jar:${m2}/org/scijava/jython-shaded/2.5.3/jython-shaded-2.5.3.jar:${HOME}/git/kservices/src gov.nasa.jpl.kservices.KtoJava "$@"

if [ "$solve" = true ] ; then 

	javac -classpath ${HOME}/git/kservices/target/classes:${HOME}/git/Klang/target/classes:${HOME}/git/Klang/src/antlr-4.4-complete.jar:${m2}/org/antlr/antlr4/4.5/antlr4-4.5.jar:${m2}/org/antlr/antlr4-runtime/4.5/antlr4-runtime-4.5.jar:${m2}/org/abego/treelayout/org.abego.treelayout.core/1.0.1/org.abego.treelayout.core-1.0.1.jar:${m2}/org/antlr/antlr-runtime/3.5.2/antlr-runtime-3.5.2.jar:${m2}/org/antlr/ST4/4.0.8/ST4-4.0.8.jar:${m2}/log4j/log4j/1.2.16/log4j-1.2.16.jar:${HOME}/git/Klang/lib/com.microsoft.z3.jar:${m2}/javax/servlet/servlet-api/2.4/servlet-api-2.4.jar:${m2}/org/eclipse/jetty/jetty-server/9.2.12.v20150709/jetty-server-9.2.12.v20150709.jar:${m2}/javax/servlet/javax.servlet-api/3.1.0/javax.servlet-api-3.1.0.jar:${m2}/org/eclipse/jetty/jetty-http/9.2.12.v20150709/jetty-http-9.2.12.v20150709.jar:${m2}/org/eclipse/jetty/jetty-util/9.2.12.v20150709/jetty-util-9.2.12.v20150709.jar:${m2}/org/eclipse/jetty/jetty-io/9.2.12.v20150709/jetty-io-9.2.12.v20150709.jar:${m2}/org/scala-lang/scala-library/2.11.8/scala-library-2.11.8.jar:${m2}/org/scala-lang/scala-actors/2.11.8/scala-actors-2.11.8.jar:${m2}/org/scala-lang/modules/scala-xml_2.11/1.0.3/scala-xml_2.11-1.0.3.jar:${m2}/org/scala-lang/modules/scala-parser-combinators_2.11/1.0.3/scala-parser-combinators_2.11-1.0.3.jar:${m2}/org/scala-lang/modules/scala-swing_2.11/1.0.1/scala-swing_2.11-1.0.1.jar:${HOME}/git/bae/target/classes:/private/var/folders/bx/c5nzpxn14fqdplw7hbznyx0xgnhpqy/T/AppTranslocation/E7A90B53-9C5E-48BD-909F-383F1A03D8AC/d/Eclipse.app/Contents/Eclipse/plugins/org.junit_4.12.0.v201504281640/junit.jar:/private/var/folders/bx/c5nzpxn14fqdplw7hbznyx0xgnhpqy/T/AppTranslocation/E7A90B53-9C5E-48BD-909F-383F1A03D8AC/d/Eclipse.app/Contents/Eclipse/plugins/org.hamcrest.core_1.3.0.v201303031735.jar:${m2}/gov/nasa/jpl/mbee/util/mbee_util/2.3.4-SNAPSHOT/mbee_util-2.3.4-SNAPSHOT.jar:${m2}/org/json/json/20140107/json-20140107.jar:${m2}/org/apache/commons/commons-lang3/3.0/commons-lang3-3.0.jar:${HOME}/git/sysml/target/classes:${HOME}/git/util/bin:${m2}/junit/junit/4.8.1/junit-4.8.1.jar:${m2}/org/apache/commons/commons-collections4/4.0/commons-collections4-4.0.jar:${m2}/org/eclipse/emf/org.eclipse.emf.ecore/2.9.1-v20130827-0309/org.eclipse.emf.ecore-2.9.1-v20130827-0309.jar:${m2}/concurrent/concurrent/1.3.3/concurrent-1.3.3.jar:${m2}/org/scijava/jython-shaded/2.5.3/jython-shaded-2.5.3.jar:${m2}/log4j/log4j/1.2.17/log4j-1.2.17.jar:${m2}/gov/nasa/jpl/mbee/sysml/sysml/2.3.4-SNAPSHOT/sysml-2.3.4-SNAPSHOT.jar:${m2}/gov/nasa/jpl/mbee/bae/bae/2.3.4-SNAPSHOT/bae-2.3.4-SNAPSHOT.jar ${HOME}/git/kservices/src/generatedCode/*.java

	java -classpath ${HOME}/git/kservices/target/classes:${HOME}/git/Klang/target/classes:${HOME}/git/Klang/src/antlr-4.4-complete.jar:${m2}/org/antlr/antlr4/4.5/antlr4-4.5.jar:${m2}/org/antlr/antlr4-runtime/4.5/antlr4-runtime-4.5.jar:${m2}/org/abego/treelayout/org.abego.treelayout.core/1.0.1/org.abego.treelayout.core-1.0.1.jar:${m2}/org/antlr/antlr-runtime/3.5.2/antlr-runtime-3.5.2.jar:${m2}/org/antlr/ST4/4.0.8/ST4-4.0.8.jar:${m2}/log4j/log4j/1.2.16/log4j-1.2.16.jar:${HOME}/git/Klang/lib/com.microsoft.z3.jar:${m2}/javax/servlet/servlet-api/2.4/servlet-api-2.4.jar:${m2}/org/eclipse/jetty/jetty-server/9.2.12.v20150709/jetty-server-9.2.12.v20150709.jar:${m2}/javax/servlet/javax.servlet-api/3.1.0/javax.servlet-api-3.1.0.jar:${m2}/org/eclipse/jetty/jetty-http/9.2.12.v20150709/jetty-http-9.2.12.v20150709.jar:${m2}/org/eclipse/jetty/jetty-util/9.2.12.v20150709/jetty-util-9.2.12.v20150709.jar:${m2}/org/eclipse/jetty/jetty-io/9.2.12.v20150709/jetty-io-9.2.12.v20150709.jar:${m2}/org/scala-lang/scala-library/2.11.8/scala-library-2.11.8.jar:${m2}/org/scala-lang/scala-actors/2.11.8/scala-actors-2.11.8.jar:${m2}/org/scala-lang/modules/scala-xml_2.11/1.0.3/scala-xml_2.11-1.0.3.jar:${m2}/org/scala-lang/modules/scala-parser-combinators_2.11/1.0.3/scala-parser-combinators_2.11-1.0.3.jar:${m2}/org/scala-lang/modules/scala-swing_2.11/1.0.1/scala-swing_2.11-1.0.1.jar:${HOME}/git/bae/target/classes:/private/var/folders/bx/c5nzpxn14fqdplw7hbznyx0xgnhpqy/T/AppTranslocation/E7A90B53-9C5E-48BD-909F-383F1A03D8AC/d/Eclipse.app/Contents/Eclipse/plugins/org.junit_4.12.0.v201504281640/junit.jar:/private/var/folders/bx/c5nzpxn14fqdplw7hbznyx0xgnhpqy/T/AppTranslocation/E7A90B53-9C5E-48BD-909F-383F1A03D8AC/d/Eclipse.app/Contents/Eclipse/plugins/org.hamcrest.core_1.3.0.v201303031735.jar:${m2}/gov/nasa/jpl/mbee/util/mbee_util/2.3.4-SNAPSHOT/mbee_util-2.3.4-SNAPSHOT.jar:${m2}/org/json/json/20140107/json-20140107.jar:${m2}/org/apache/commons/commons-lang3/3.0/commons-lang3-3.0.jar:${HOME}/git/sysml/target/classes:${HOME}/git/util/bin:${m2}/junit/junit/4.8.1/junit-4.8.1.jar:${m2}/org/apache/commons/commons-collections4/4.0/commons-collections4-4.0.jar:${m2}/org/eclipse/emf/org.eclipse.emf.ecore/2.9.1-v20130827-0309/org.eclipse.emf.ecore-2.9.1-v20130827-0309.jar:${m2}/concurrent/concurrent/1.3.3/concurrent-1.3.3.jar:${m2}/org/scijava/jython-shaded/2.5.3/jython-shaded-2.5.3.jar:${m2}/log4j/log4j/1.2.17/log4j-1.2.17.jar:${m2}/gov/nasa/jpl/mbee/sysml/sysml/2.3.4-SNAPSHOT/sysml-2.3.4-SNAPSHOT.jar:${m2}/gov/nasa/jpl/mbee/bae/bae/2.3.4-SNAPSHOT/bae-2.3.4-SNAPSHOT.jar:${HOME}/git/kservices/src generatedCode.Main

	rm ${HOME}/git/kservices/src/generatedCode/*

	rm ${HOME}/git/kservices/src/gov/nasa/jpl/kservices/*.class
fi
